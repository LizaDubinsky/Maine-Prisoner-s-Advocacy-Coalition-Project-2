---
title: "Time_Served"
output: html_document
date: '2022-05-16'
---

```{r setup, include=FALSE}
knitr::opts_chunk$set(echo = TRUE)
```

## R Markdown

This is an R Markdown document. Markdown is a simple formatting syntax for authoring HTML, PDF, and MS Word documents. For more details on using R Markdown see <http://rmarkdown.rstudio.com>.

When you click the **Knit** button a document will be generated that includes both content as well as the output of any embedded R code chunks within the document. You can embed an R code chunk like this:

###Time Served


```{r}
library(readr)
library(readxl)
library(leaflet)
library(ggplot2)
library(dplyr)
library(tidyverse)



Time_Served_Trends <- read_excel("Time Served Trends.xlsx")


#states without parole
stateswop <- c("AZ", "CA", "DE", "FL", "IL", "IA", "KS", "ME", "MN", "NM", "NC", "OH", "OR", "VA", "WA", "WI")

#putting df into new object and changing the column names
Time_served_df <- Time_Served_Trends[2:582,]
colnames(Time_served_df)[3] <- "MEAN TIME SERVED (ALL OFFENSES)"
colnames(Time_served_df)[4] <- "MEAN TIME SERVED (VIOLENT OFFENSES)"
colnames(Time_served_df)[5] <- "MEAN TIME SERVED (NONVIOLENT OFFENSES)"
colnames(Time_served_df)[7] <- "MEAN TIME SERVED BY DECILE (BOTTOM 90%)"
colnames(Time_served_df)[8] <- "MEAN TIME SERVED BY DECILE (TOP 10%)"

Time_served_df <- Time_served_df %>%
  mutate(parole = case_when(STATE %in% stateswop ~ "No",
                            TRUE ~ "Yes"
    ), across(c(3:8), as.numeric), across(c(3:8), round))

#creating shorter df for streamgraph
Time_served_df_plot <- Time_served_df %>%
  select(STATE:`MEAN TIME SERVED (ALL OFFENSES)`) %>%
  group_by(YEAR) %>%
  arrange(desc(YEAR))
    

#Time_served_df$`MEAN TIME SERVED (ALL OFFENSES)` = round(Time_served_df$`MEAN TIME SERVED (ALL OFFENSES)`, 2)) #across to do it to multiple, ask laurie if you can specifiy digits in across rfunction, wasn't able to 



#creating a plot
devtools::install_github("hrbrmstr/streamgraph")
library(streamgraph)

colnames(Time_served_df_plot) <- c("State", "Year", "Avg_Time_Served_all")

#pp <- streamgraph(Time_served_df_plot, key = Time_served_df_plot$State, value = #Time_served_df_plot$`Avg Time Served (all)`, date = Time_served_df_plot$Year, height="300px", width="1000px")
 # sg_legend(show=TRUE, label="STATE")

##ask laurie why isn't this code working?? 

#pp <- streamgraph(Time_served_df,Time_served_df[,1], Time_served_df[,3],Time_served_df[,2], height="300px", width="1000px")
#Error in .subset(x, j) : invalid subscript type 'list'



```

```{r}
#change labels
#color by parole or not parole in Country
#check for better way to visualize?

Time_served_df_plot %>%
ggplot(aes(x=Year, y=Avg_Time_Served_all, group=State)) +
    geom_line(aes(group=State), color="grey", size=0.5, alpha=0.5) +
    geom_line(aes(color=State), color="#69b3a2", size=1.2 ) +
    #scale_color_viridis(discrete = TRUE) +
    #theme_ipsum() +
    theme(
      legend.position="none",
      plot.title = element_text(size=14),
      panel.grid = element_blank()
    ) +
    ggtitle("A spaghetti chart of baby names popularity") +
    facet_wrap(~State)
```


Note that the `echo = FALSE` parameter was added to the code chunk to prevent printing of the R code that generated the plot.
